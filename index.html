<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Tactical Shooter</title>
    <style>
        :root {
            --blue: #3b82f6;
            --purple: #9333ea;
            --red: #ef4444;
            --slate-900: #0f172a;
            --slate-800: #1e293b;
            --slate-100: #f1f5f9;
            --white: #ffffff;
        }
        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--slate-900);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--slate-800);
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* UI Overlays */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(4px);
            z-index: 20;
            transition: opacity 0.3s;
        }
        .hidden { display: none !important; }
        
        /* Typography */
        h1 { margin: 0 0 10px 0; font-size: 40px; font-weight: 900; letter-spacing: -1px; text-align: center; }
        p.subtitle { margin: 0 0 30px 0; font-size: 14px; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }

        /* HUD */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; padding: 20px;
            box-sizing: border-box;
            display: flex; justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }
        .hud-panel {
            background: rgba(255,255,255,0.9);
            padding: 10px 15px; border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid var(--blue);
        }
        .hud-label { font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; display: block; }
        .hud-value { font-size: 24px; font-weight: 900; color: var(--slate-800); line-height: 1; }

        /* Buttons & Menu */
        .menu-container { width: 100%; max-width: 400px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; gap: 10px; }
        
        .diff-btn {
            width: 100%; padding: 15px; border-radius: 12px;
            border: 2px solid #e2e8f0; background: white;
            cursor: pointer; display: flex; align-items: center; justify-content: space-between;
            transition: all 0.2s; text-align: left;
        }
        .diff-btn:hover { border-color: #cbd5e1; }
        .diff-btn.selected { transform: scale(1.02); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .diff-info { display: flex; flex-direction: column; }
        .diff-name { font-weight: 800; font-size: 14px; color: #64748b; }
        .diff-desc { font-size: 12px; color: #94a3b8; font-weight: 500; }
        .diff-btn.selected .diff-name { color: var(--slate-900); }

        .start-btn {
            margin-top: 10px; width: 100%; padding: 16px;
            border-radius: 99px; border: none;
            background: var(--slate-900); color: white;
            font-size: 18px; font-weight: 800;
            cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            transition: transform 0.1s;
        }
        .start-btn:active { transform: scale(0.95); }

        .secondary-btn {
            padding: 12px; background: none; border: none;
            color: #64748b; font-weight: 700; cursor: pointer;
            margin-top: 5px;
        }
        .secondary-btn:hover { color: var(--slate-800); }

        /* Icon shapes */
        .shape-icon { width: 12px; height: 12px; display: inline-block; margin-right: 10px; border-radius: 2px; }
    </style>
</head>
<body>

    <div id="hud" class="hidden">
        <div class="hud-panel" id="scorePanel">
            <span class="hud-label">Score</span>
            <span class="hud-value" id="scoreVal">0</span>
        </div>
        <div class="hud-panel" style="border-left: none; border-right: 4px solid #ccc;" id="diffPanel">
            <span class="hud-label">Difficulty</span>
            <span class="hud-value" id="diffVal">NORMAL</span>
        </div>
    </div>

    <!-- MAIN MENU -->
    <div id="menuOverlay" class="overlay">
        <h1 id="menuTitle" style="color: var(--blue)">NEON TACTICAL</h1>
        <p class="subtitle" id="menuSubtitle">Operational Readiness: Green</p>

        <div class="menu-container">
            <button class="diff-btn" onclick="setDifficulty('EASY')" id="btn-EASY">
                <div style="display:flex; align-items:center">
                    <span class="shape-icon" style="background:var(--blue)"></span>
                    <div class="diff-info"><span class="diff-name">RECRUIT</span><span class="diff-desc">Easy</span></div>
                </div>
            </button>
            <button class="diff-btn selected" onclick="setDifficulty('NORMAL')" id="btn-NORMAL" style="border-color:var(--blue); background:#eff6ff">
                <div style="display:flex; align-items:center">
                    <span class="shape-icon" style="background:var(--blue)"></span>
                    <div class="diff-info"><span class="diff-name">VETERAN</span><span class="diff-desc">Normal</span></div>
                </div>
            </button>
            <button class="diff-btn" onclick="setDifficulty('HARD')" id="btn-HARD">
                <div style="display:flex; align-items:center">
                    <span class="shape-icon" style="background:var(--purple)"></span>
                    <div class="diff-info"><span class="diff-name">ELITE</span><span class="diff-desc">Hard</span></div>
                </div>
            </button>
            <button class="diff-btn" onclick="setDifficulty('IMPOSSIBLE')" id="btn-IMPOSSIBLE">
                <div style="display:flex; align-items:center">
                    <span class="shape-icon" style="background:var(--red)"></span>
                    <div class="diff-info"><span class="diff-name">LEGEND</span><span class="diff-desc">Impossible</span></div>
                </div>
            </button>
            
            <button class="start-btn" onclick="startGame()" id="startBtn">ENGAGE</button>
            <div style="text-align:center; margin-top:10px; font-size:12px; color:#94a3b8">HIGH SCORE: <span id="highScoreVal">0</span></div>
        </div>
    </div>

    <!-- GAME OVER -->
    <div id="gameOverOverlay" class="overlay hidden">
        <h1 style="color: var(--red); font-size: 50px;">MISA</h1>
        <p class="subtitle">Mission Failed</p>
        
        <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); text-align: center; min-width: 250px;">
            <span class="hud-label">Final Score</span>
            <div style="font-size: 48px; font-weight: 900; color: var(--slate-800); margin: 10px 0;" id="finalScoreVal">0</div>
        </div>

        <div class="menu-container">
            <button class="start-btn" onclick="startGame()">RETRY MISSION</button>
            <button class="secondary-btn" onclick="showMenu()">RETURN TO BASE</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    /** 
     * PURE VANILLA JS GAME ENGINE 
     * No Libraries. No Build Steps. Just Code.
     */

    // --- CONFIGURATION ---
    const DIFFICULTIES = {
        EASY: {
            label: "RECRUIT", color: "#3b82f6", bg: "#eff6ff",
            spawnRateBase: 90, bulletSpeedMult: 0.7, playerShotInterval: 14
        },
        NORMAL: {
            label: "VETERAN", color: "#3b82f6", bg: "#eff6ff",
            spawnRateBase: 70, bulletSpeedMult: 0.9, playerShotInterval: 10
        },
        HARD: {
            label: "ELITE", color: "#9333ea", bg: "#faf5ff",
            spawnRateBase: 52, bulletSpeedMult: 1.3, playerShotInterval: 8
        },
        IMPOSSIBLE: {
            label: "LEGEND", color: "#ef4444", bg: "#fef2f2",
            spawnRateBase: 45, bulletSpeedMult: 1.4, playerShotInterval: 6
        }
    };

    const COLORS = {
        player: '#3b82f6',
        playerCore: '#ef4444',
        tri: '#eab308', // Yellow
        sq: '#f97316',  // Orange
        pent: '#d946ef',// Pink/Purple
        circ: '#ef4444' // Red
    };

    // --- STATE ---
    let canvas, ctx;
    let gameState = 'menu'; // menu, playing, gameover
    let currentDiff = 'NORMAL';
    let score = 0;
    let highScore = 0;
    let frameCount = 0;
    let width, height;

    // Entities
    let player = { x: 0, y: 0, size: 12 };
    let target = { x: 0, y: 0 };
    let pBullets = [];
    let enemies = [];
    let eBullets = [];
    let particles = [];

    // --- INITIALIZATION ---
    window.onload = () => {
        canvas = document.getElementById('gameCanvas');
        ctx = canvas.getContext('2d');
        
        // Input Listeners
        window.addEventListener('resize', resize);
        canvas.addEventListener('mousemove', e => handleInput(e.clientX, e.clientY, false));
        canvas.addEventListener('touchmove', e => { e.preventDefault(); handleInput(e.touches[0].clientX, e.touches[0].clientY, true); }, {passive: false});
        canvas.addEventListener('touchstart', e => { handleInput(e.touches[0].clientX, e.touches[0].clientY, true); }, {passive: false});

        resize();
        loop(); // Start loop immediately
    };

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        if(gameState === 'menu') {
            player.x = width / 2;
            player.y = height - 100;
            target.x = width / 2;
            target.y = height - 100;
        }
    }

    function handleInput(x, y, isTouch) {
        if (gameState !== 'playing') return;
        target.x = x;
        target.y = isTouch ? y - 70 : y;
    }

    // --- GAME LOGIC ---
    function setDifficulty(lvl) {
        currentDiff = lvl;
        
        // Update UI Visuals
        const conf = DIFFICULTIES[lvl];
        document.getElementById('menuTitle').style.color = conf.color;
        
        const subtitles = {
            EASY: 'Readiness: Green',
            NORMAL: 'Readiness: Standard',
            HARD: 'Warning: High Hostility',
            IMPOSSIBLE: 'DANGER: EXTREME HAZARD'
        };
        document.getElementById('menuSubtitle').innerText = subtitles[lvl];

        const startBtn = document.getElementById('startBtn');
        startBtn.style.background = lvl === 'IMPOSSIBLE' ? '#ef4444' : (lvl === 'HARD' ? '#9333ea' : '#0f172a');

        // Update Buttons state
        ['EASY', 'NORMAL', 'HARD', 'IMPOSSIBLE'].forEach(d => {
            const btn = document.getElementById('btn-'+d);
            const icon = btn.querySelector('.shape-icon');
            if (d === lvl) {
                btn.className = 'diff-btn selected';
                btn.style.borderColor = conf.color;
                btn.style.background = conf.bg;
                icon.style.background = conf.color;
            } else {
                btn.className = 'diff-btn';
                btn.style.borderColor = '#e2e8f0';
                btn.style.background = '#fff';
                icon.style.background = '#cbd5e1';
            }
        });
    }

    function startGame() {
        document.getElementById('menuOverlay').classList.add('hidden');
        document.getElementById('gameOverOverlay').classList.add('hidden');
        document.getElementById('hud').classList.remove('hidden');
        
        // HUD Setup
        const conf = DIFFICULTIES[currentDiff];
        document.getElementById('diffPanel').style.borderRightColor = conf.color;
        document.getElementById('scorePanel').style.borderLeftColor = conf.color;
        document.getElementById('diffVal').innerText = conf.label;

        // Reset State
        score = 0;
        frameCount = 0;
        pBullets = [];
        enemies = [];
        eBullets = [];
        particles = [];
        player.x = width / 2;
        player.y = height - 100;
        target.x = player.x;
        target.y = player.y;
        
        updateScore(0);
        gameState = 'playing';
    }

    function showMenu() {
        gameState = 'menu';
        document.getElementById('menuOverlay').classList.remove('hidden');
        document.getElementById('gameOverOverlay').classList.add('hidden');
        document.getElementById('hud').classList.add('hidden');
    }

    function gameOver() {
        gameState = 'gameover';
        createParticles(player.x, player.y, COLORS.player, 50, 2);
        
        if (score > highScore) {
            highScore = score;
            document.getElementById('highScoreVal').innerText = highScore.toLocaleString();
        }

        setTimeout(() => {
            document.getElementById('gameOverOverlay').classList.remove('hidden');
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('finalScoreVal').innerText = score.toLocaleString();
        }, 800);
    }

    function updateScore(val) {
        score = val;
        document.getElementById('scoreVal').innerText = score.toLocaleString();
    }

    // --- MAIN LOOP ---
    function loop() {
        // Clear
        ctx.fillStyle = '#f8fafc';
        ctx.fillRect(0, 0, width, height);

        if (gameState === 'playing') {
            updateGame();
        }
        
        drawGame();
        requestAnimationFrame(loop);
    }

    function updateGame() {
        const conf = DIFFICULTIES[currentDiff];
        frameCount++;
        
        // Scaling Tier (Every 1000 score)
        const tier = Math.floor(score / 1000);

        // Player Move
        player.x += (target.x - player.x) * 0.15;
        player.y += (target.y - player.y) * 0.15;
        // Bounds
        player.x = Math.max(12, Math.min(width - 12, player.x));
        player.y = Math.max(12, Math.min(height - 12, player.y));

        // Player Fire (Dynamic Speed)
        const fireRate = Math.max(4, conf.playerShotInterval - tier);
        if (frameCount % fireRate === 0) {
            pBullets.push({ x: player.x, y: player.y - 20 });
        }

        // Enemy Spawn (Dynamic Rate)
        // Increased difficulty scaling factor from 3 to 5 to make 5000+ much harder
        const spawnReduction = tier * 5; 
        const spawnRate = Math.max(15, conf.spawnRateBase - spawnReduction);

        if (frameCount % spawnRate === 0) {
            const r = Math.random();
            let type = 'tri';

            // Logic
            if (currentDiff === 'EASY') {
                type = r < 0.6 ? 'tri' : 'sq';
            } else if (currentDiff === 'NORMAL') {
                if(r<0.15) type='pent'; else if(r<0.5) type='tri'; else if(r<0.9) type='sq'; else type='circ';
            } else if (currentDiff === 'HARD') {
                if(r<0.20) type='pent'; else if(r<0.5) type='tri'; else if(r<0.85) type='sq'; else type='circ';
            } else if (currentDiff === 'IMPOSSIBLE') {
                type = r < 0.4 ? 'pent' : 'circ';
            }

            let hp, clr, spd, sc;
            switch(type) {
                case 'tri': 
                    hp=1; clr=COLORS.tri; spd=(height/180)+Math.random(); 
                    // Fixed score per difficulty (Multiples of 10)
                    if(currentDiff==='EASY') sc=10; else if(currentDiff==='HARD') sc=30; else sc=20; 
                    break;
                case 'sq':  
                    hp=5; clr=COLORS.sq;  spd=(height/400)+Math.random(); 
                    if(currentDiff==='EASY') sc=30; else if(currentDiff==='HARD') sc=60; else sc=50;
                    break;
                case 'pent':
                    hp=6; clr=COLORS.pent;spd=(height/300)+Math.random(); 
                    if(currentDiff==='IMPOSSIBLE') sc=200; else if(currentDiff==='HARD') sc=120; else if(currentDiff==='EASY') sc=50; else sc=80;
                    break;
                case 'circ':
                    hp=6; clr=COLORS.circ;spd=(height/250);               
                    if(currentDiff==='IMPOSSIBLE') sc=300; else if(currentDiff==='HARD') sc=200; else if(currentDiff==='EASY') sc=100; else sc=150;
                    break;
            }

            enemies.push({
                x: Math.random() * (width - 40) + 20,
                y: -40, type: type, hp: hp, maxHp: hp, color: clr, size: 18, speed: spd, hasShot: false, scoreVal: sc
            });
        }

        // Update Bullets
        for (let i = pBullets.length - 1; i >= 0; i--) {
            pBullets[i].y -= 20;
            if (pBullets[i].y < -20) pBullets.splice(i, 1);
        }

        // Update Enemies
        for (let i = enemies.length - 1; i >= 0; i--) {
            let e = enemies[i];
            e.y += e.speed;

            // Attack Logic
            if (e.y > 0 && e.y < height) {
                if ((e.type === 'tri' || e.type === 'sq') && !e.hasShot) {
                    let trigger = e.type === 'tri' ? height*0.2 : height*0.3;
                    if (e.y > trigger) {
                        let ang = Math.atan2(player.y - e.y, player.x - e.x);
                        fireEnemyBullet(e.x, e.y, ang, 6 * conf.bulletSpeedMult, e.color);
                        e.hasShot = true;
                    }
                }
                if (e.type === 'circ' && frameCount % 40 === 0) {
                    let ang = Math.atan2(player.y - e.y, player.x - e.x);
                    fireEnemyBullet(e.x, e.y, ang, 7 * conf.bulletSpeedMult, e.color);
                }
                if (e.type === 'pent' && !e.hasShot) {
                    if (e.y > height * 0.25) {
                        e.hasShot = true;
                        for(let k=0; k<12; k++) {
                            let ang = (Math.PI*2*k)/12 + (Date.now()/1000);
                            fireEnemyBullet(e.x, e.y, ang, 4 * conf.bulletSpeedMult, e.color);
                        }
                        e.speed *= 0.5;
                    }
                }
            }

            // Player Collision
            if (Math.hypot(player.x - e.x, player.y - e.y) < 6 + e.size) {
                gameOver();
                return;
            }

            // Bullet Collision
            for (let j = pBullets.length - 1; j >= 0; j--) {
                let b = pBullets[j];
                if (Math.abs(b.x - e.x) < e.size+10 && Math.abs(b.y - e.y) < e.size+10) {
                    createParticles(e.x, e.y, e.color, 3);
                    pBullets.splice(j, 1);
                    e.hp--;
                    if (e.hp <= 0) {
                        createParticles(e.x, e.y, e.color, 15, 1.5);
                        updateScore(score + e.scoreVal);
                        enemies.splice(i, 1);
                        break;
                    }
                }
            }

            if (e.y > height + 50) enemies.splice(i, 1);
        }

        // Enemy Bullets
        for (let i = eBullets.length - 1; i >= 0; i--) {
            let b = eBullets[i];
            b.x += b.vx; b.y += b.vy;
            if (Math.hypot(player.x - b.x, player.y - b.y) < 10) {
                gameOver();
                return;
            }
            if (b.x < -50 || b.x > width+50 || b.y < -50 || b.y > height+50) eBullets.splice(i, 1);
        }

        // Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.04;
            if (p.life <= 0) particles.splice(i, 1);
        }
    }

    function fireEnemyBullet(x, y, ang, spd, col) {
        eBullets.push({ x: x, y: y, vx: Math.cos(ang)*spd, vy: Math.sin(ang)*spd, color: col });
    }

    function createParticles(x, y, col, count, speedMult=1) {
        for(let i=0; i<count; i++) {
            let ang = Math.random() * Math.PI * 2;
            let spd = Math.random() * 5 * speedMult;
            particles.push({
                x: x, y: y, vx: Math.cos(ang)*spd, vy: Math.sin(ang)*spd, life: 1.0, color: col, size: Math.random()*3+2
            });
        }
    }

    // --- DRAWING ---
    function drawGame() {
        // Player
        ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.beginPath(); ctx.arc(player.x, player.y+20, 12, 0, Math.PI*2); ctx.fill(); // Shadow
        ctx.fillStyle = COLORS.player;
        ctx.beginPath(); 
        ctx.moveTo(player.x, player.y-18); 
        ctx.lineTo(player.x-12, player.y+12); 
        ctx.lineTo(player.x, player.y+6); 
        ctx.lineTo(player.x+12, player.y+12); 
        ctx.fill();
        ctx.fillStyle = COLORS.playerCore; ctx.beginPath(); ctx.arc(player.x, player.y, 4, 0, Math.PI*2); ctx.fill();

        // Player Bullets
        ctx.fillStyle = '#1e293b';
        pBullets.forEach(b => ctx.fillRect(b.x-2, b.y, 4, 15));

        // Enemies
        enemies.forEach(e => {
            ctx.fillStyle = e.color;
            if (e.type === 'tri') {
                ctx.beginPath(); ctx.moveTo(e.x, e.y+e.size); ctx.lineTo(e.x-e.size, e.y-e.size); ctx.lineTo(e.x+e.size, e.y-e.size); ctx.fill();
            } else if (e.type === 'sq') {
                ctx.fillRect(e.x-e.size, e.y-e.size, e.size*2, e.size*2);
            } else if (e.type === 'pent') {
                ctx.beginPath();
                for(let k=0; k<5; k++) {
                    let a = (Math.PI*2*k)/5 - Math.PI/2;
                    let px = e.x + Math.cos(a)*e.size;
                    let py = e.y + Math.sin(a)*e.size;
                    if(k===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
                }
                ctx.fill();
                ctx.fillStyle = '#fdf4ff'; ctx.beginPath(); ctx.arc(e.x, e.y, e.size/2, 0, Math.PI*2); ctx.fill();
            } else {
                ctx.beginPath(); ctx.arc(e.x, e.y, e.size, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = '#fff'; ctx.fillRect(e.x-2, e.y-8, 4, 16); ctx.fillRect(e.x-8, e.y-2, 16, 4);
            }
        });

        // Enemy Bullets
        eBullets.forEach(b => {
            ctx.fillStyle = b.color;
            ctx.beginPath(); ctx.arc(b.x, b.y, 6, 0, Math.PI*2); ctx.fill();
        });

        // Particles
        particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1.0;
        });
    }

</script>
</body>
</html>